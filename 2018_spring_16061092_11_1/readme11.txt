#第11次作业readme
一、以前作业的bug。
第十次作业被报了4个error型bug，简而言之都在申诉，下面我从他报的bug角度解释一下我程序：
1.他说我流量没有检测到，车在只能左右行走的一行走了回头路，我的解释是：流量检测的时间间隔为500ms，即每500ms更新一次流量，而我的出租车行走一条边之后sleep500ms，可能在出租车还没到的时候，流量更新了，这时候该边的流量还是0，因此车是有可能走回头路的。（通过观察gui也能看出来）
2.。。。没时间解释了

二、readme部分。

！！！写在前面的
因写的较为仓促，没有写针对可追踪出租车历史信息的测试线程，希望测试者可以根据代码写一下，实在抱歉，时间不够了。。。。

本次readme是在以前的readme基础上做的修改，如有不合理地方还请海涵~
（25条之后为第11次作业新增内容，请测试者着重留意一下，谢谢~）

1.处理输入（一行只能有一个乘客请求，格式不符合直接忽略并报错，从控制台读取时间，在100ms范围内的算作一个时间（个位和十位的数字相当于被忽略，即系统时间t取整方式为取<=t的整百ms数））
接受输入的任意位置的空格，坐标数大部分时候不支持前导0（只有当坐标数<10时支持1个前导0）
标识符为CR

2.同质请求：最多接受300个CR请求（有效请求）。当没到300个CR请求，但是输入了END，测试线程也会结束，END之后的CR请求，OPEN，CLOSE请求均不处理。

3.若地图行数不等于80或某一列列数少于80，则输出“图有问题”，其余时候（行数为80，列数>=80）,取前80列正常处理。

4.若出租车在抢单成功后进入停止状态（因为等待服务状态每隔20s都要停止1s），则该出租车退出当前抢单队列，若该出租车在该单派单窗口关闭前返回等待服务状态，并且满足该单的抢单要求，则能够再次抢单，与之前的抢单算作两次抢单，信用度需要加两次。

5.乘客请求在7.5s时间窗内抢单结束，得到当前抢单队列，并在抢单队列里循环查找最佳出租车（且处于等待服务状态），若一次循环结束后得到的最佳车辆在被派单前被别的乘客请求派单了，则需要重新循环遍历，得到新的最佳请求，直到寻找到处于等待服务状态的最佳车辆，或者是当前队列里的所有车辆都不处于等待服务状态，此时，退出循环，输出“派单失败，请重新叫车”，此外一些未知错误可能也会导致派单失败，输出“派单失败，请重新叫车”，该单并没有成功派单。

6.关于输出到文件里的系统时间问题。
（1）由于抢单的时间窗口是在该请求发出后3s关闭，窗口关闭后，才开始循环寻找最佳车辆并且派单的，所以，理论上派单时间与请求发出时间相隔超过7.5s（一般在10s左右），响应抢单的车越多，间隔时间越长，望大佬理解。
（2）接单过程出租车行走使用假时间，服务过程出租车行走也是使用假时间，但是中间的过渡使用的是真实时间，比如某出租车在a时刻接单，开始驶向乘客位置，过程的输出到每个点的时间间隔相差均为500ms（不等红灯的情况，若等红灯是500+等红灯时间），用假时间，该出租车到达乘客位置时间和到达时的真实系统时间不同，此时取真实时间b。之后的服务状态和接单状态相似，过程输出的每个点的时间间隔相差均为500ms（不等红灯的情况，若等红灯是500+等红灯时间）。这样就会出现接单状态的最后到达乘客位置时刻和服务状态开始时刻相差比1000ms大的情况，望同学理解，谢谢~~


7.由于输出到文件的顺序可能被线程的不确定性打乱，我尽量在每个输出都添加了识别信息，（该车车牌号，该单的乘客标识符等等，希望方便您的阅读）到达目的地时刻就写在经停信息里面了。（至于换行...emmm我太菜了并没有时间研究出来怎么换行，您就将就着看吧，谢谢~）

8.到时候您map的文件位置和map_light文件的位置需要修改一下~，修改成您电脑上文件所在位置，保证为绝对路径~

9.无效输入再补充一点：坐标大小不符合要求的（大于79或小于0的），发出请求所在地与目的地相同的，统一输出“输入坐标大小不满足条件”，并忽略该请求。

10.关于出租车等待服务状态时刻随机走的问题，出租车遇到岔路口，随机选择有路的临边走，不会停在当前点。

11.输出文件的信息：只要乘客发出的请求非同质，就会输出乘客请求内容到文件中，只要该乘客请求在窗口关闭时刻的当前抢单队列不为空，则输出在抢单时间窗内所有参与抢单的出租车信息到文件中，只要有出租车被派单，则输出被派单车辆的运行信息到文件里。
#输出时的车辆状态有四种：0（STOP）停止状态
1（WAIT）等待服务状态
2（ORDER）接单状态
3（SERVE）服务状态

12.单号就是每个乘客请求的当前抢单队列里车辆的编号，从0开始编号。

13.只有在输入乘客请求发出时间时，因为采用百毫秒为精确度，用了假时间，其余都是真时间。

14.只有到达该位置时刻，才更新出租车当前位置

15.过多车辆响应抢单，系统容易出错，很可能导致派单失败请同学理解~需要重新叫车~

16.关于新添的随时打开或关闭道路：
#直接在控制台输入打开或关闭道路指令	
打开道路的格式为[OPEN,(x0,y0),(x1,y1)]，一行只能输入一条开启道路指令
关闭道路的格式为[CLOSE,(x0,y0),(x1,y1)]，一行只能输入一条关闭道路指令
（需要由测试者保证同一时间最多只能改变5个连接边。）
OPEN，CLOSE是标识符，坐标数大部分时候不支持前导0（只有当坐标<10时支持1个前导0），这点和输入CR请求时的要求相同。
当成功加入该边时，输出“加入该边成功”（需要由测试者保证加入的边是最初地图就有的边）
当成功删除该边时，输出“删除该边成功”（需要由测试者保证删除该边后，该地图还是联通的）

17.车流量最大值不能超过int型。

18.出租车每次行走之前需要判断路径是否存在，即再次寻找从当前坐标到目的地坐标的最短路径。
若在判断之后该边突然被删除，程序捕捉不到无法避免，望测试者理解~谢谢~。

19.出现一些不可描述的问题后，可能是由于GUI导致的，测试者可以尝试着将GUI部分注释掉再次运行，谢谢~
且所有牵涉到的GUI问题都请测试者忽略~谢谢~

20.！！！只支持在控制台输入Load filename指令，若filename路径不存在，则输出filename+路径不存在。
只支持在初始化的时候使用该指令，在输入有效CR请求之后输入该指令，则该指令会被忽略。
若第一行不是#No 9 Test File#，输出“文件格式错误”，该文件内其他内容不会读入。

21.关于红绿灯地图，需要修改Light类里红绿灯地图文件的位置，地图文件规格为80*80，由0和1组成，若有其他数字，报出“红绿灯图有问题”，程序退出。
测试者需要保证设置红绿灯的地方需要有十字路口或者丁字路口。

22.初始化所有灯的变化间隔时间相同，为一个500-1000ms之间的随机数。且初始化时，所有的红绿灯都都处于绿灯。因每个红绿灯变换间隔相同且初始化状态相同，所有的红绿灯同时变换，变换后的状态还是一样的。

23.若车处于等待服务状态，经过十字路口，规定出租车先利用第九次作业的规定选择一个方向，再判断是否需要等红灯。

24.对写入文件的内容进行修改，若接单过程中或服务过程中，车等了红灯，则会有相关提示输出，将原来的“车服务状态经停位置坐标"”==》“车服务状态等红灯后经停位置坐标”。

25.关于打开道路边的问题：不可以打开地图上原本不存在的边。（需要由测试者保证，但是如果打开了也是可以的）可以关闭所有当前有边的边。（当前有边：地图上原来有没被关闭的或者地图上被打开的边）
------------------------------work_11新增------------------------------------------

26.由于我的程序不支持打开地图上原本不存在的边，指导书上说可追踪出租车能够行走关闭的道路，我的规定是，可追踪出租车可以行走初始时地图上所有的边（不管是否存在边）。不存在的边的流量始终保持为0。

27.
-------------------------关于Load filename指令---------------------------------------
第一行必须是#No 9 Test File#
之后的顺序不一定严格按照先map,再flow,再taxi,再request的顺序。
但是单看每一个的顺序还是有的，比如先是#map，再是地图文件，再是#end_map。
文件名必须为完整路径，否则可能找不到文件。
文件内多余的空行会被忽略，比如#No 9 Test File#与#map之间的空行，可以有可以没，这些都不重要。
1）地图文件格式：与map.txt的格式要求相同，要求测试者给出符合要求的地图文件，保证图的连通性，完整性。
2）flow指定道路流量基础值格式：(x1,y1) (x2,y2) value
两个坐标之间有空格，坐标和value之间也有空格。
(x1,y1)，(x2,y2)两点之间必须有边，且value的值为非负整数。
坐标数大部分时候不支持前导0（只有当坐标<10时支持1个前导0）。
value支持长度小于等于10大于等于1的数字（可以有前导0）。
判断若存在（x1,y1）到（x2,y2）的连接边，则输出“该边存在，成功改变流量初值”。
否则，输出“该边不存在，无法该边流量初值”。
#flow与#end_flow之间的无效输入直接被忽略，不报错
3）指定出租车状态、信用、位置格式：
No. Status Credit (x,y)
No.为出租车编号，为0-99间正整数，只有当编号小于10时，支持一个前导0

Status为出租车状态，为求方便，出租车状态和指导书状态不同，请测试者注意~
出租车状态有四种：
0（STOP）停止状态
1（WAIT）等待服务状态
2（ORDER）接单状态
3（SERVE）服务状态
Status只能为0-3之间整数，需由测试者保证

Credit为出租车信用，为整数，支持长度小于等于10大于等于1的数字（可以有前导0）。

（x,y）为初始化出租车坐标，坐标数x,y大部分时候不支持前导0（只有当坐标数<10时支持1个前导0）

下面是对初始化出租车状态，信用，位置信息的设计：
初始化信用度和位置都可以直接改变，不会有什么牵扯，因此首先初始化该出租车的位置和信用度。
初始化状态为STOP（0），则出租车当前初始化状态为STOP状态，1s后切换到WAIT（1）状态。
初始化状态为WAIT（1），则出租车当前初始化状态为WAIT状态，即正常的等待服务状态，若此时出租车正处于WAIT状态，此指令不会对其状态造成任何影响。
初始化状态为ORDER（2），则出租车当前初始化状态为ORDER状态，这时需要假设一个乘客，ta发出了一个在出租车当前位置的请求，接单到达乘客位置后，由于实际乘客不存在，设定该单已结束，将出租车状态设定为WAIT状态。
到达乘客上车地点后，控制台会输出“到达乘客上车地点”，且passmess.txt文件也会记录相应信息。（一切时间均采用真实时间，因此可能与理论值有差距，望同学理解~~）
初始化状态为SERVE（3），则出租车当前初始化状态为SERVE状态，这时需要假设一个乘客，模拟ta需要1s上车时间，上车后，出租车当前的目的地（即乘客的目的地）就是出租车初始化位置坐标。
到达乘客目的地后，控制台会输出“No.到达目的地”，passmess.txt文件也会有相应的记录。（一切时间均采用真实时间，因此可能与理论值有差距，望同学理解~~）

4）发出请求格式：
#request和#end_request之间为发出的请求，格式与正常发出请求的格式相同，[CR,(x0,y0),(x1,y1)]

只支持此种格式，且此处的END程序不会有任何响应。
----------------------------------------新添----------------------------------------------------
5）红绿灯文件格式：与上述要求红绿灯文件格式相同，若红绿灯文件为空，则保持当前红绿灯文件不变。

----------------------------------控制台输入测试样例--------------------------------------------
//注意此处应该将文件名补充完整，设为文件的完整路径。
Load file.txt //只能在初始化的时候用该指令，也可以不用   
[CLOSE,(43,43),(43,44)]
[OPEN,(43,43),(43,44)]
[CR,(43,43),(43,44)]
[CLOSE,(42,12),(12,13)]
[CR,(40,40),(50,50)]
[CLOSE,(50,49),(50,50)]
